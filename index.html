<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Trivia VR - Diseño Final Limpio</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>

    <script>
      // ==========================================
      // CONFIGURACIÓN DE DATOS (BASE DE DATOS)
      // ==========================================
      const DATABASE = {
        'ES': {
            ui: { titulo: "BIENVENIDO", sub_idioma: "SELECCIONA TU IDIOMA", elige_pais: "ELIGE LA TEMÁTICA", score: "PUNTAJE FINAL", restart: "VOLVER A JUGAR" },
            paises: { 'PE': 'PERÚ', 'US': 'EE.UU.', 'FR': 'FRANCIA', 'DE': 'ALEMANIA' },
            data: {
                'PE': [
                    { q: "¿Cuál es la capital del Perú?", ops: ["Arequipa", "Lima", "Cusco", "Trujillo"], ans: 1 },
                    { q: "¿Qué animal aparece en el escudo?", ops: ["Llama", "Cóndor", "Vicuña", "Alpaca"], ans: 2 },
                    { q: "¿En qué año se descubrió Machu Picchu?", ops: ["1911", "1900", "1821", "1950"], ans: 0 },
                    { q: "¿Cuál es el río más largo del Perú?", ops: ["Rímac", "Amazonas", "Ucayali", "Marañón"], ans: 2 },
                    { q: "¿Quién es el héroe de Angamos?", ops: ["Bolognesi", "Quiñones", "Grau", "Ugarte"], ans: 2 },
                    { q: "¿Cuál es la moneda oficial?", ops: ["Peso", "Dólar", "Sol", "Inti"], ans: 2 },
                    { q: "¿Dónde está el Lago Titicaca?", ops: ["Puno", "Tacna", "Loreto", "Cusco"], ans: 0 },
                    { q: "¿Plato bandera de pescado crudo?", ops: ["Lomo Saltado", "Ceviche", "Cuy", "Ají de Gallina"], ans: 1 },
                    { q: "¿Cuál es la montaña más alta?", ops: ["Misti", "Huandoy", "Huascarán", "Yerupajá"], ans: 2 },
                    { q: "¿Ciudad conocida como la Ciudad Blanca?", ops: ["Lima", "Trujillo", "Arequipa", "Piura"], ans: 2 }
                ],
                'US': [ 
                    { q: "¿Capital de Estados Unidos?", ops: ["NY", "Washington DC", "Miami", "LA"], ans: 1 },
                    { q: "¿Moneda oficial?", ops: ["Euro", "Dólar", "Yen", "Libra"], ans: 1 },
                    { q: "¿Presidente en el billete de $1?", ops: ["Lincoln", "Washington", "Franklin", "Grant"], ans: 1 },
                    { q: "¿Dónde está Hollywood?", ops: ["Florida", "Texas", "California", "Nevada"], ans: 2 },
                    { q: "¿Día de la Independencia?", ops: ["4 Julio", "1 Mayo", "25 Dic", "1 Enero"], ans: 0 },
                    { q: "¿Animal nacional?", ops: ["Águila Calva", "Oso", "Toro", "León"], ans: 0 },
                    { q: "¿Cuántos estados tiene?", ops: ["48", "50", "52", "45"], ans: 1 },
                    { q: "¿Ciudad de la Gran Manzana?", ops: ["Chicago", "New York", "Boston", "Seattle"], ans: 1 },
                    { q: "¿Río famoso que cruza el Gran Cañón?", ops: ["Misisipi", "Colorado", "Amazonas", "Nilo"], ans: 1 },
                    { q: "¿Deporte del Super Bowl?", ops: ["Béisbol", "Fútbol", "Basket", "Fútbol Americano"], ans: 3 }
                ]
            }
        },
        'EN': {
             ui: { titulo: "WELCOME", sub_idioma: "SELECT YOUR LANGUAGE", elige_pais: "CHOOSE TOPIC", score: "FINAL SCORE", restart: "PLAY AGAIN" },
             paises: { 'PE': 'PERU', 'US': 'USA', 'FR': 'FRANCE', 'DE': 'GERMANY' },
             data: {
                'PE': [{ q: "Capital of Peru?", ops: ["Arequipa", "Lima", "Cusco", "Trujillo"], ans: 1 }],
                'US': [{ q: "Capital of USA?", ops: ["NY", "DC", "Miami", "LA"], ans: 1 }]
             }
        }
      };

      let state = { lang: 'ES', topic: 'PE', qIndex: 0, score: 0, isAnswered: false, musicStarted: false };

      AFRAME.registerComponent('game-logic', {
        init: function () {
            this.menuLang = document.querySelector('#menu-idioma');
            this.menuTopic = document.querySelector('#menu-tema');
            this.gameUI = document.querySelector('#ui-juego');
            this.endUI = document.querySelector('#ui-final');
            this.bgMusic = document.querySelector('#bg-music');
            this.soundWin = document.querySelector('#sound-win');
            this.soundFail = document.querySelector('#sound-fail');
            this.resetGame();
        },
        startMusic: function() {
            if(!state.musicStarted && this.bgMusic) { this.bgMusic.components.sound.playSound(); state.musicStarted = true; }
        },
        resetGame: function() {
            state.qIndex = 0; state.score = 0; state.isAnswered = false;
            this.ocultarTodo();
            this.mostrar(this.menuLang);
        },
        setLang: function(l) {
            this.startMusic();
            state.lang = l;
            const txts = DATABASE[state.lang].ui;
            document.querySelector('#titulo-tema').setAttribute('value', txts.elige_pais);
            document.querySelector('#titulo-score').setAttribute('value', txts.score);
            document.querySelector('#txt-restart').setAttribute('value', txts.restart);
            const p = DATABASE[state.lang].paises;
            document.querySelector('#txt-pe').setAttribute('value', p.PE);
            document.querySelector('#txt-us').setAttribute('value', p.US);
            document.querySelector('#txt-fr').setAttribute('value', p.FR);
            document.querySelector('#txt-de').setAttribute('value', p.DE);
            this.transicion(this.menuLang, this.menuTopic);
        },
        setTopic: function(t) {
            state.topic = t;
            if(!DATABASE[state.lang].data[t]) { state.topic = 'PE'; }
            this.transicion(this.menuTopic, this.gameUI);
            this.loadQuestion();
        },
        loadQuestion: function() {
            state.isAnswered = false;
            const currentData = DATABASE[state.lang].data[state.topic];
            if(state.qIndex >= currentData.length || state.qIndex >= 10) { this.showEndScreen(); return; }
            const q = currentData[state.qIndex];
            document.querySelector('#txt-contador').setAttribute('value', `${state.qIndex + 1} / 10`);
            document.querySelector('#txt-pregunta').setAttribute('value', q.q);
            for(let i=0; i<4; i++) {
                let btn = document.querySelector(`#btn-op-${i}`);
                let txt = document.querySelector(`#txt-op-${i}`);
                // Reset visual al rojo ESAN
                btn.setAttribute('color', '#B61F25'); 
                if(i < q.ops.length) {
                    txt.setAttribute('value', q.ops[i]);
                    btn.classList.add('clickable'); btn.setAttribute('visible', true);
                } else {
                    btn.classList.remove('clickable'); btn.setAttribute('visible', false);
                }
            }
        },
        checkAnswer: function(selectedIndex) {
            if(state.isAnswered) return;
            state.isAnswered = true;
            const q = DATABASE[state.lang].data[state.topic][state.qIndex];
            const btnSelected = document.querySelector(`#btn-op-${selectedIndex}`);
            if(selectedIndex === q.ans) {
                state.score++;
                btnSelected.setAttribute('color', '#4CAF50'); // Verde
                if(this.soundWin) this.soundWin.components.sound.playSound();
            } else {
                btnSelected.setAttribute('color', '#555'); // Gris oscuro para error
                document.querySelector(`#btn-op-${q.ans}`).setAttribute('color', '#4CAF50'); // Mostrar la correcta
                if(this.soundFail) this.soundFail.components.sound.playSound();
            }
            setTimeout(() => { state.qIndex++; this.loadQuestion(); }, 2000);
        },
        showEndScreen: function() {
            this.transicion(this.gameUI, this.endUI);
            document.querySelector('#txt-score-final').setAttribute('value', `${state.score} / 10`);
        },
        transicion: function(salida, entrada) {
            salida.setAttribute('visible', false); salida.setAttribute('position', '0 -999 0');
            this.mostrar(entrada);
        },
        mostrar: function(el) {
            el.setAttribute('visible', true);
            el.setAttribute('position', '0 1.6 -4'); // Posición estándar a 4 metros
            el.setAttribute('scale', '0.1 0.1 0.1');
            el.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 500; easing: easeOutBack');
        },
        ocultarTodo: function() {
            [this.menuLang, this.menuTopic, this.gameUI, this.endUI].forEach(el => {
                el.setAttribute('visible', false); el.setAttribute('position', '0 -999 0');
            });
        }
      });

      AFRAME.registerComponent('btn-action', {
        schema: { type: {type:'string'}, val: {type:'string'} },
        init: function() {
            let el = this.el; let data = this.data;
            el.addEventListener('mouseenter', () => {
                if(state.isAnswered && data.type === 'ans') return;
                el.setAttribute('scale', '1.05 1.05 1.05');
                el.setAttribute('material', 'emissive', '#ffaaaa'); // Brillo rojizo al mirar
            });
            el.addEventListener('mouseleave', () => {
                el.setAttribute('scale', '1 1 1');
                el.setAttribute('material', 'emissive', '#000');
            });
            el.addEventListener('click', () => {
                let logic = document.querySelector('a-scene').components['game-logic'];
                if(data.type === 'lang') logic.setLang(data.val);
                if(data.type === 'topic') logic.setTopic(data.val);
                if(data.type === 'ans') logic.checkAnswer(parseInt(data.val));
                if(data.type === 'restart') logic.resetGame();
            });
        }
      });
    </script>
  </head>
  <body>
    <a-scene game-logic cursor="rayOrigin: mouse" raycaster="objects: .clickable">
      <a-assets>
        <img id="fondo360" src="fondo360.jpg">
        <img id="logo" src="ESAN.png">
        <audio id="src-music" src="musica.mp3" loop="true"></audio>
        <audio id="src-win" src="win.mp3"></audio>
        <audio id="src-fail" src="fail.mp3"></audio>

        <a-mixin id="panel-bg" geometry="primitive: box; depth: 0.05" material="color: #FFFFFF; shader: flat"></a-mixin>
        <a-mixin id="btn-red" geometry="primitive: box; depth: 0.08; height: 0.5; width: 2.5"
                 material="color: #B61F25"></a-mixin>
        <a-mixin id="txt-visible" text="font: roboto; align: center; z-offset: 0.05; material.shader: flat; material.fog: false"></a-mixin>
      </a-assets>

      <a-entity id="bg-music" sound="src: #src-music; volume: 0.2"></a-entity>
      <a-entity id="sound-win" sound="src: #src-win; volume: 1"></a-entity>
      <a-entity id="sound-fail" sound="src: #src-fail; volume: 1"></a-entity>

      <a-sky src="#fondo360" radius="60" rotation="0 -90 0"></a-sky>
      <a-light type="directional" position="-1 2 1" intensity="0.6"></a-light>
      <a-light type="ambient" intensity="0.8"></a-light>

      <a-entity id="rig">
        <a-camera position="0 1.6 0" look-controls="pointerLockEnabled: false"></a-camera>
        <a-entity hand-controls="hand: right" laser-controls="hand: right" raycaster="objects: .clickable; far: 10; lineColor: #B61F25"></a-entity>
        <a-entity hand-controls="hand: left"></a-entity>
      </a-entity>

      <a-entity id="menu-idioma">
        <a-entity mixin="panel-bg" width="4" height="4" position="0 0.5 -0.1"></a-entity>
        
        <a-image src="#logo" position="0 1.9 0.1" width="1.5" height="1.5"></a-image>
        
        <a-text value="BIENVENIDO" mixin="txt-visible" position="0 1.1 0.1" color="#B61F25" scale="1.5 1.5 1.5"></a-text>
        <a-text id="sub-idioma" value="SELECCIONA TU IDIOMA" mixin="txt-visible" position="0 0.7 0.1" color="#555"></a-text>

        <a-entity position="0 0 0">
            <a-entity class="clickable" btn-action="type: lang; val: ES" mixin="btn-red" position="-1.4 0.2 0">
                <a-text value="ESPAÑOL" mixin="txt-visible" color="white"></a-text>
            </a-entity>
            <a-entity class="clickable" btn-action="type: lang; val: EN" mixin="btn-red" position="1.4 0.2 0">
                <a-text value="ENGLISH" mixin="txt-visible" color="white"></a-text>
            </a-entity>
            <a-entity class="clickable" btn-action="type: lang; val: FR" mixin="btn-red" position="-1.4 -0.5 0">
                <a-text value="FRANÇAIS" mixin="txt-visible" color="white"></a-text>
            </a-entity>
            <a-entity class="clickable" btn-action="type: lang; val: DE" mixin="btn-red" position="1.4 -0.5 0">
                <a-text value="DEUTSCH" mixin="txt-visible" color="white"></a-text>
            </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="menu-tema" visible="false">
        <a-entity mixin="panel-bg" width="4" height="3" position="0 0 -0.1"></a-entity>
        <a-text id="titulo-tema" value="ELIGE PAIS" mixin="txt-visible" position="0 1.1 0.1" color="#B61F25" scale="1.2 1.2 1.2"></a-text>
        
        <a-entity position="0 -0.2 0">
            <a-entity class="clickable" btn-action="type: topic; val: PE" mixin="btn-red" position="-1.4 0.4 0">
                <a-text id="txt-pe" value="PERÚ" mixin="txt-visible" color="white"></a-text>
            </a-entity>
            <a-entity class="clickable" btn-action="type: topic; val: US" mixin="btn-red" position="1.4 0.4 0">
                <a-text id="txt-us" value="EE.UU." mixin="txt-visible" color="white"></a-text>
            </a-entity>
            <a-entity class="clickable" btn-action="type: topic; val: FR" mixin="btn-red" position="-1.4 -0.4 0">
                <a-text id="txt-fr" value="FRANCIA" mixin="txt-visible" color="white"></a-text>
            </a-entity>
            <a-entity class="clickable" btn-action="type: topic; val: DE" mixin="btn-red" position="1.4 -0.4 0">
                <a-text id="txt-de" value="ALEMANIA" mixin="txt-visible" color="white"></a-text>
            </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="ui-juego" visible="false">
        <a-entity position="0 2.1 0">
            <a-entity mixin="btn-red" width="2" height="0.4"></a-entity>
            <a-text id="txt-contador" value="1 / 10" mixin="txt-visible" color="white"></a-text>
        </a-entity>

        <a-entity mixin="panel-bg" width="5.8" height="1.1" position="0 1.2 0"></a-entity>
        <a-text id="txt-pregunta" value="..." mixin="txt-visible" color="#333" width="5.5" position="0 1.2 0.1"></a-text>

        <a-entity position="0 -0.5 0">
            <a-entity id="btn-op-0" class="clickable" btn-action="type: ans; val: 0" mixin="btn-red" position="-1.4 0.6 0" width="2.6">
                <a-text id="txt-op-0" value="A" mixin="txt-visible" width="4.5" color="white"></a-text>
            </a-entity>
            <a-entity id="btn-op-1" class="clickable" btn-action="type: ans; val: 1" mixin="btn-red" position="1.4 0.6 0" width="2.6">
                <a-text id="txt-op-1" value="B" mixin="txt-visible" width="4.5" color="white"></a-text>
            </a-entity>
            <a-entity id="btn-op-2" class="clickable" btn-action="type: ans; val: 2" mixin="btn-red" position="-1.4 -0.2 0" width="2.6">
                <a-text id="txt-op-2" value="C" mixin="txt-visible" width="4.5" color="white"></a-text>
            </a-entity>
            <a-entity id="btn-op-3" class="clickable" btn-action="type: ans; val: 3" mixin="btn-red" position="1.4 -0.2 0" width="2.6">
                <a-text id="txt-op-3" value="D" mixin="txt-visible" width="4.5" color="white"></a-text>
            </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="ui-final" visible="false">
        <a-entity mixin="panel-bg" width="4" height="3.5" position="0 0.5 -0.1"></a-entity>
        
        <a-text id="titulo-score" value="PUNTAJE FINAL" mixin="txt-visible" position="0 1.5 0.1" color="#B61F25" scale="1.2 1.2 1.2"></a-text>
        <a-text id="txt-score-final" value="0 / 10" mixin="txt-visible" position="0 0.5 0.1" width="20" color="#4CAF50"></a-text>

        <a-entity class="clickable" btn-action="type: restart; val: 0" position="0 -0.6 0.2">
            <a-cylinder color="#B61F25" height="0.1" radius="0.7" rotation="30 0 0"></a-cylinder>
            <a-text id="txt-restart" value="VOLVER A JUGAR" mixin="txt-visible" position="0 0.05 0.1" rotation="-30 0 0" width="4" color="white"></a-text>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>
