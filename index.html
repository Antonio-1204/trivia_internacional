<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Trivia VR - ESAN</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>

    <script>
      // GESTOR DEL JUEGO
      AFRAME.registerComponent('game-manager', {
        init: function () {
          this.menu = document.querySelector('#menu-principal');
          this.game = document.querySelector('#escenario-juego');
          this.welcomeText = document.querySelector('#texto-bienvenida-juego');
          
          this.game.setAttribute('visible', false);
          this.game.setAttribute('position', '0 -10 0');
        },
        startGame: function (pais) {
          // Ocultar Menú
          this.menu.setAttribute('animation', 'property: scale; to: 0 0 0; dur: 500; easing: easeInBack');
          
          setTimeout(() => {
            this.menu.setAttribute('visible', false);
            // Mostrar Juego
            this.game.setAttribute('visible', true);
            this.game.setAttribute('position', '0 0 0');
            this.game.setAttribute('animation', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 1000; easing: easeOutElastic');
            
            this.welcomeText.setAttribute('value', `Mucha suerte!\nRepresentando a: ${pais}`);
          }, 500);
        }
      });

      // BOTONES DEL MENÚ
      AFRAME.registerComponent('vr-button', {
        schema: {
          value: {type: 'string', default: ''},
          type: {type: 'string', default: 'pais'} 
        },
        init: function () {
          var el = this.el;
          var data = this.data;
          
          el.addEventListener('mouseenter', function () {
            el.setAttribute('color', '#D32F2F'); // Rojo más claro al mirar
            el.setAttribute('scale', '1.1 1.1 1.1');
          });
          el.addEventListener('mouseleave', function () {
            el.setAttribute('color', '#B61F25'); // Rojo ESAN
            el.setAttribute('scale', '1 1 1');
          });

          el.addEventListener('click', function () {
            if (data.type === 'start') {
              var manager = document.querySelector('[game-manager]').components['game-manager'];
              manager.startGame('PERU'); 
            } else {
              console.log("Seleccionado: " + data.value);
            }
          });
        }
      });
      
      // BOTÓN DE RESPUESTA (JUEGO)
      AFRAME.registerComponent('trivia-button', {
        init: function () {
            var el = this.el;
            el.addEventListener('click', function() {
                el.setAttribute('animation', 'property: position; to: 0 0.45 0; dur: 100; dir: alternate; loop: 1');
                var txt = document.querySelector('#pregunta-texto');
                txt.setAttribute('value', '¡Respuesta Recibida!');
                txt.setAttribute('color', '#00FF00');
                setTimeout(() => {
                    txt.setAttribute('value', 'Siguiente pregunta...');
                    txt.setAttribute('color', '#333');
                }, 2000);
            });
        }
      });
    </script>
  </head>
  <body>
    <a-scene game-manager>
      
      <a-assets>
        <img id="fondo-esan" src="PIEZA-GENERAL_3.jpg">
        <img id="logo-esan" src="image_6aef09.png">
        
        <a-mixin id="texto-boton" text="align: center; color: white; width: 4; font: roboto"></a-mixin>
      </a-assets>

      <a-sky src="#fondo-esan" rotation="0 -90 0"></a-sky>

      <a-light type="ambient" intensity="0.8"></a-light>
      <a-light type="directional" position="-1 1 1" intensity="0.6"></a-light>

      <a-entity id="rig" position="0 0 0">
        <a-camera position="0 1.6 0" look-controls="pointerLockEnabled: false" wasd-controls="enabled: false">
            <a-cursor color="yellow" raycaster="objects: .interactuable" fuse="false"></a-cursor>
        </a-camera>
        
        <a-entity id="rightHand" 
                  hand-controls="hand: right; handModelStyle: highPoly; color: #ffcccc"
                  laser-controls="hand: right"
                  raycaster="objects: .interactuable; far: 5; showLine: true; lineColor: #B61F25">
        </a-entity>
        
        <a-entity hand-controls="hand: left; handModelStyle: highPoly; color: #ffcccc"></a-entity>
      </a-entity>

      <a-entity id="menu-principal" position="0 1.6 -2.5">
        
        <a-box color="white" opacity="0.9" depth="0.1" height="3" width="4.5" position="0 0 0" shadow></a-box>
        
        <a-image src="#logo-esan" position="0 1.1 0.06" width="1.5" height="1.5" scale="0.6 0.6 0.6"></a-image>

        <a-text value="TRIVIA INTERNACIONAL" align="center" position="0 0.6 0.07" color="#B61F25" width="7" font="exo2bold"></a-text>

        <a-text value="SELECCIONA TU EQUIPO" align="center" position="0 0.2 0.07" color="#555" width="4"></a-text>
        
        <a-entity position="0 -0.2 0.1">
            <a-box class="interactuable" vr-button="value: PE" position="-1 0 0" width="1.4" height="0.4" depth="0.05" color="#B61F25">
                <a-text mixin="texto-boton" value="PERU" position="0 0 0.03"></a-text>
            </a-box>
            <a-box class="interactuable" vr-button="value: MX" position="1 0 0" width="1.4" height="0.4" depth="0.05" color="#B61F25">
                <a-text mixin="texto-boton" value="MEXICO" position="0 0 0.03"></a-text>
            </a-box>
        </a-entity>

        <a-cylinder class="interactuable" vr-button="type: start" 
                    position="0 -1.0 0.5" rotation="30 0 0" radius="0.35" height="0.1" color="#B61F25"
                    animation="property: scale; dir: alternate; dur: 1200; to: 1.05 1.05 1.05; loop: true">
            <a-text value="EMPEZAR" align="center" position="0 0.06 0" rotation="-90 0 0" color="white" width="5" font="exo2bold"></a-text>
        </a-cylinder>

      </a-entity>

      <a-entity id="escenario-juego" position="0 -10 0" visible="false">
        
        <a-curvedimage color="#fff" height="3.0" radius="5.7" theta-length="72"
                       rotation="0 144 0" scale="0.8 0.8 0.8" position="0 2.2 -3" opacity="0.9"></a-curvedimage>
        
        <a-image src="#logo-esan" position="0 3.2 -3" width="1" height="1" scale="0.5 0.5 0.5"></a-image>

        <a-text id="texto-bienvenida-juego" value="" font="kelsonsans" align="center" width="6" position="0 2.5 -2.9" color="#B61F25"></a-text>
        <a-text id="pregunta-texto" value="¿Cual es la capital de Francia?" font="kelsonsans" align="center" width="5" position="0 2.0 -2.9" color="#333"></a-text>

        <a-entity position="0 0.8 -2">
            <a-cylinder color="#333" height="1" radius="0.15"></a-cylinder>
            <a-cylinder class="interactuable" trivia-button color="#B61F25" height="0.1" radius="0.2" position="0 0.55 0">
                <a-text value="!" align="center" position="0 0.06 0" rotation="-90 0 0" color="white" width="10"></a-text>
            </a-cylinder>
        </a-entity>

      </a-entity>

    </a-scene>
  </body>
</html>
